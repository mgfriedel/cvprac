

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>cvprac.cvp_api &mdash; REST API client for communicating with an Arista Cloudvision(R) Portal node. develop documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'develop',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> REST API client for communicating with an Arista Cloudvision(R) Portal node.
          

          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../README.html">Arista CloudvisionÂ® Portal RESTful API Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#getting-started">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#notes-for-api-class-usage">Notes for API Class Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#testing">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#contributing">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#contact-questions">Contact/Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../README.html#license">License</a></li>
</ul>
<p class="caption"><span class="caption-text">Code documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">cvprac</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">REST API client for communicating with an Arista Cloudvision(R) Portal node.</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>cvprac.cvp_api</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for cvprac.cvp_api</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (c) 2017, Arista Networks, Inc.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1">#   Redistributions of source code must retain the above copyright notice,</span>
<span class="c1">#   this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1">#   Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#   notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#   documentation and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1">#   Neither the name of Arista Networks nor the names of its</span>
<span class="c1">#   contributors may be used to endorse or promote products derived from</span>
<span class="c1">#   this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1"># &#39;AS IS&#39; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c1"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL ARISTA NETWORKS</span>
<span class="c1"># BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="c1"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="c1"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR</span>
<span class="c1"># BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span>
<span class="c1"># WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE</span>
<span class="c1"># OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN</span>
<span class="c1"># IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">#</span>
<span class="sd">&#39;&#39;&#39; Class containing calls to CVP RESTful API.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># This import is for proper file IO handling support for both Python 2 and 3</span>
<span class="c1"># pylint: disable=redefined-builtin</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="nb">open</span>

<span class="kn">from</span> <span class="nn">cvprac.cvp_client_errors</span> <span class="k">import</span> <span class="n">CvpApiError</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">quote_plus</span> <span class="k">as</span> <span class="n">qplus</span>
<span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">ImportError</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">quote_plus</span> <span class="k">as</span> <span class="n">qplus</span>


<div class="viewcode-block" id="CvpApi"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi">[docs]</a><span class="k">class</span> <span class="nc">CvpApi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; CvpApi class contains calls to CVP RESTful API.  The RESTful API</span>
<span class="sd">        parameters are passed in as parameters to the method.  The results of</span>
<span class="sd">        the RESTful API call are converted from json to a dict and returned.</span>
<span class="sd">        Where needed minimal processing is performed on the results.</span>
<span class="sd">        Any method that does a cvprac get or post call could raise the</span>
<span class="sd">        following errors:</span>

<span class="sd">        ConnectionError: A ConnectionError is raised if there was a network</span>
<span class="sd">            problem (e.g. DNS failure, refused connection, etc)</span>
<span class="sd">        CvpApiError: A CvpApiError is raised if there was a JSON error.</span>
<span class="sd">        CvpRequestError: A CvpRequestError is raised if the request is not</span>
<span class="sd">            properly constructed.</span>
<span class="sd">        CvpSessionLogOutError: A CvpSessionLogOutError is raised if</span>
<span class="sd">            reponse from server indicates session was logged out.</span>
<span class="sd">        HTTPError: A HTTPError is raised if there was an invalid HTTP response.</span>
<span class="sd">        ReadTimeout: A ReadTimeout is raised if there was a request</span>
<span class="sd">            timeout when reading from the connection.</span>
<span class="sd">        Timeout: A Timeout is raised if there was a request timeout.</span>
<span class="sd">        TooManyRedirects: A TooManyRedirects is raised if the request exceeds</span>
<span class="sd">            the configured number of maximum redirections</span>
<span class="sd">        ValueError: A ValueError is raised when there is no valid</span>
<span class="sd">            CVP session.  This occurs because the previous get or post request</span>
<span class="sd">            failed and no session could be established to a CVP node.  Destroy</span>
<span class="sd">            the class and re-instantiate.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># pylint: disable=too-many-public-methods</span>
    <span class="c1"># pylint: disable=too-many-lines</span>

<div class="viewcode-block" id="CvpApi.__init__"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clnt</span><span class="p">,</span> <span class="n">request_timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Initialize the class.</span>

<span class="sd">            Args:</span>
<span class="sd">                clnt (obj): A CvpClient object</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span> <span class="o">=</span> <span class="n">clnt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">clnt</span><span class="o">.</span><span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span> <span class="o">=</span> <span class="n">request_timeout</span></div>

<div class="viewcode-block" id="CvpApi.get_cvp_info"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_cvp_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_cvp_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns information about CVP.</span>

<span class="sd">            Returns:</span>
<span class="sd">                cvp_info (dict): CVP Information</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">is_cvaas</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/cvpInfo/getCvpInfo.do&#39;</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For CVaaS do not run the getCvpInfo REST API and assume the</span>
            <span class="c1"># latest version of the API</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;cvaas&#39;</span><span class="p">}</span>
        <span class="k">if</span> <span class="s1">&#39;version&#39;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">set_version</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="c1"># pylint: disable=too-many-arguments</span>
<div class="viewcode-block" id="CvpApi.add_user"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_user">[docs]</a>    <span class="k">def</span> <span class="nf">add_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span>
                 <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add new local user to the CVP UI.</span>

<span class="sd">            Args:</span>
<span class="sd">                username (str): local username on CVP</span>
<span class="sd">                password (str): password of the user</span>
<span class="sd">                role (str): role of the user</span>
<span class="sd">                status (str): state of the user (Enabled/Disabled)</span>
<span class="sd">                first_name (str): first name of the user</span>
<span class="sd">                last_name (str): last name of the user</span>
<span class="sd">                email (str): email address of the user</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Invalid status </span><span class="si">%s</span><span class="s1">.&#39;</span>
                           <span class="s1">&#39; Status must be Enabled or Disabled.&#39;</span>
                           <span class="s1">&#39; Defaulting to Disabled&#39;</span> <span class="o">%</span> <span class="n">status</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Disabled&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;roles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">role</span><span class="p">],</span>
                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;contactNumber&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
                         <span class="s2">&quot;firstName&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span>
                         <span class="s2">&quot;lastName&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span>
                         <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
                         <span class="s2">&quot;userId&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                         <span class="s2">&quot;userStatus&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">}}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/user/addUser.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.update_user"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.update_user">[docs]</a>    <span class="k">def</span> <span class="nf">update_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">role</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Updates username information, like</span>
<span class="sd">            changing password, disable/enable the username</span>
<span class="sd">            and user role.</span>

<span class="sd">            Args:</span>
<span class="sd">                username (str): local username on CVP</span>
<span class="sd">                password (str): password of the user</span>
<span class="sd">                status (str): status of user (enable/disable)</span>
<span class="sd">                role (str): role of the user</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Enabled&#39;</span><span class="p">,</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Invalid status </span><span class="si">%s</span><span class="s1">.&#39;</span>
                           <span class="s1">&#39; Status must be Enabled or Disabled.&#39;</span>
                           <span class="s1">&#39; Defaulting to Disabled&#39;</span> <span class="o">%</span> <span class="n">status</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;Disabled&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;userId&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                         <span class="s2">&quot;userType&quot;</span><span class="p">:</span> <span class="s2">&quot;Local&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;userStatus&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                         <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">},</span>
                <span class="s2">&quot;roles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">role</span><span class="p">]}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/user/updateUser.do?userId=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">),</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_user"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_user">[docs]</a>    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns specified user information</span>

<span class="sd">            Args:</span>
<span class="sd">                username (str): username on CVP</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/user/getUser.do?userId=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.delete_user"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_user">[docs]</a>    <span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove specified user from CVP</span>

<span class="sd">            Args:</span>
<span class="sd">                username (str): username on CVP</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">username</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/user/deleteUsers.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_task_by_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_task_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the current CVP Task status for the task with the specified</span>
<span class="sd">            TaskId.</span>

<span class="sd">            Args:</span>
<span class="sd">                task_id (int): CVP task identifier</span>

<span class="sd">            Returns:</span>
<span class="sd">                task (dict): The CVP task for the associated Id.  Returns None</span>
<span class="sd">                    if the task_id was invalid.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_task_by_id: task_id: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/task/getTaskById.do?taskId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CvpApiError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Caught error: </span><span class="si">%s</span><span class="s1"> attempting to get task.&#39;</span> <span class="o">%</span> <span class="n">error</span><span class="p">)</span>
            <span class="c1"># Catch an invalid task_id error and return None</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">task</span></div>

<div class="viewcode-block" id="CvpApi.get_tasks_by_status"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_tasks_by_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_tasks_by_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of tasks with the given status.</span>

<span class="sd">            Args:</span>
<span class="sd">                status (str): Task status</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tasks (list): The list of tasks</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_tasks_by_status: status: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">status</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;/task/getTasks.do?queryparam=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CvpApi.get_tasks"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_tasks">[docs]</a>    <span class="k">def</span> <span class="nf">get_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of all the tasks.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tasks (dict): The &#39;total&#39; key contains the number of tasks,</span>
<span class="sd">                    the &#39;data&#39; key contains a list of the tasks.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_tasks:&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/task/getTasks.do?queryparam=&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;&#39;</span>
                             <span class="s1">&#39;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_logs_by_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_logs_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_logs_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the log entries for the task with the specified TaskId.</span>

<span class="sd">            Args:</span>
<span class="sd">                task_id (int): CVP task identifier</span>
<span class="sd">                start (int): The first log entry to return.  Default is 0.</span>
<span class="sd">                end (int): The last log entry to return.  Default is 0 which</span>
<span class="sd">                    means to return all log entries.  Can be a large number to</span>
<span class="sd">                    indicate the last log entry.</span>

<span class="sd">            Returns:</span>
<span class="sd">                task (dict): The CVP log for the associated Id.  Returns None</span>
<span class="sd">                    if the task_id was invalid.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_logs_by_id: task_id: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 - v4 /task/getLogsByID.do?&#39;</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/task/getLogsById.do?id=</span><span class="si">%s</span><span class="s1">&amp;queryparam=&#39;</span>
                                 <span class="s1">&#39;&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v5 /audit/getLogs.do&#39;</span><span class="p">)</span>
            <span class="n">task_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_task_by_id</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
            <span class="n">stage_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;stageId&#39;</span> <span class="ow">in</span> <span class="n">task_info</span><span class="p">:</span>
                <span class="n">stage_id</span> <span class="o">=</span> <span class="n">task_info</span><span class="p">[</span><span class="s1">&#39;stageId&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;No stage ID found for task </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;ccIdV2&#39;</span> <span class="ow">in</span> <span class="n">task_info</span><span class="p">:</span>
                <span class="n">cc_id</span> <span class="o">=</span> <span class="n">task_info</span><span class="p">[</span><span class="s1">&#39;ccIdV2&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cc_id</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;No ccIdV2 for task </span><span class="si">%s</span><span class="s1">.&#39;</span>
                                   <span class="s1">&#39; It was likely cancelled.&#39;</span>
                                   <span class="s1">&#39; Using old /task/getLogsByID.do?&#39;</span>
                                   <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;/task/getLogsById.do?id=</span><span class="si">%s</span><span class="s1">&amp;queryparam=&#39;</span>
                        <span class="s1">&#39;&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_audit_logs_by_id</span><span class="p">(</span><span class="n">cc_id</span><span class="p">,</span> <span class="n">stage_id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;No change ID found for task </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="CvpApi.get_audit_logs_by_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_audit_logs_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_audit_logs_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">,</span> <span class="n">stage_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_size</span><span class="o">=</span><span class="mi">75</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the audit logs of a particular ChangeControl.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): change control ID from ccIdV2 field</span>
<span class="sd">                stage_id (string): stage ID from stageId field</span>
<span class="sd">                data_size (int): data size</span>

<span class="sd">            Returns:</span>
<span class="sd">                task (dict): The CVP log for the associated ccIdV2</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;category&quot;</span><span class="p">:</span> <span class="s2">&quot;ChangeControl&quot;</span><span class="p">,</span>
                <span class="s2">&quot;startTime&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;endTime&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;dataSize&quot;</span><span class="p">:</span> <span class="n">data_size</span><span class="p">,</span>
                <span class="s2">&quot;objectKey&quot;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">,</span>
                <span class="s2">&quot;lastRetrievedAudit&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">if</span> <span class="n">stage_id</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stageId&quot;</span><span class="p">:</span> <span class="n">stage_id</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/cvpservice/audit/getLogs.do?&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.add_note_to_task"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_note_to_task">[docs]</a>    <span class="k">def</span> <span class="nf">add_note_to_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">note</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add notes to the task.</span>

<span class="sd">            Args:</span>
<span class="sd">                task_id (str): Task ID</span>
<span class="sd">                note (str): Note to add to the task</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;add_note_to_task: task_id: </span><span class="si">%s</span><span class="s1"> note: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">task_id</span><span class="p">,</span> <span class="n">note</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;workOrderId&#39;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="n">note</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/task/addNoteToTask.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                       <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.execute_task"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.execute_task">[docs]</a>    <span class="k">def</span> <span class="nf">execute_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Execute the task.  Note that if the task has failed then inspect</span>
<span class="sd">            the task logs to determine why the task failed.  If you see:</span>

<span class="sd">              Failure response received from the netElement: Unauthorized User</span>

<span class="sd">            then it means that the netelement does not have the same user ID</span>
<span class="sd">            and/or password as the CVP user executing the task.</span>

<span class="sd">            Args:</span>
<span class="sd">                task_id (str): Task ID</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;execute_task: task_id: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">task_id</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/task/executeTask.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                       <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.cancel_task"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.cancel_task">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Cancel the task</span>

<span class="sd">            Args:</span>
<span class="sd">                task_id (str): Task ID</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;cancel_task: task_id: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">task_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">task_id</span><span class="p">]}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/task/cancelTask.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_configlets"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlets">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of all defined configlets.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="n">configlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getConfiglets.do?&#39;</span>
                                   <span class="s1">&#39;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                                   <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">configlets</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="c1"># New API getConfiglets does not return the actual configlet config</span>
            <span class="c1"># Get the actual configlet config using getConfigletByName</span>
            <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">configlets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">configlet</span> <span class="ow">in</span> <span class="n">configlets</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
                    <span class="n">full_cfglt_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_configlet_by_name</span><span class="p">(</span>
                        <span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_cfglt_data</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">configlets</span></div>

<div class="viewcode-block" id="CvpApi.get_configlets_and_mappers"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlets_and_mappers">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlets_and_mappers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of all defined configlets and associated mappers</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;get_configlets_and_mappers: getConfigletsAndAssociatedMappers&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getConfigletsAndAssociatedMappers.do&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_configlet_builder"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlet_builder">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlet_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the configlet builder data for the given configlet ID.</span>

<span class="sd">            Args:</span>
<span class="sd">                c_id (str): The ID (key) for the configlet to be queried.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getConfigletBuilder.do?id=</span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="n">c_id</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.search_configlets"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.search_configlets">[docs]</a>    <span class="k">def</span> <span class="nf">search_configlets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of configlets that match a search query.</span>

<span class="sd">            Args:</span>
<span class="sd">                query (str): A simple string of text to be matched against</span>
<span class="sd">                    the existing configlets. Not a regex.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;search_configlets: query: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/searchConfiglets.do?&#39;</span>
                             <span class="s1">&#39;queryparam=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">qplus</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_configlet_by_name"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlet_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlet_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the configlet with the specified name</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): Name of the configlet.  Can contain spaces.</span>

<span class="sd">            Returns:</span>
<span class="sd">                configlet (dict): The configlet dict.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_configlets_by_name: name: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getConfigletByName.do?name=</span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_configlets_by_container_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlets_by_container_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlets_by_container_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of configlets applied to the given container.</span>

<span class="sd">            Args:</span>
<span class="sd">                c_id (str): The container ID (key) to query.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/getConfigletsByContainerId.do?&#39;</span>
                             <span class="s1">&#39;containerId=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">c_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_configlets_by_netelement_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlets_by_netelement_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlets_by_netelement_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of configlets applied to the given device.</span>

<span class="sd">            Args:</span>
<span class="sd">                d_id (str): The device ID (key) to query.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/getConfigletsByNetElementId.do?&#39;</span>
                             <span class="s1">&#39;netElementId=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">d_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_image_bundle_by_container_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_image_bundle_by_container_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_bundle_by_container_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_id</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                         <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of ImageBundles applied to the given container.</span>
<span class="sd">            Args:</span>
<span class="sd">                container_id (str): The container ID (key) to query.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">                scope (string) the session scope (true or false).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">scope</span> <span class="o">!=</span> <span class="s1">&#39;true&#39;</span> <span class="ow">and</span> <span class="n">scope</span> <span class="o">!=</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;scope value must be true or false.&#39;</span>
                           <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> is an invalid value.&#39;</span>
                           <span class="s1">&#39; Defaulting back to false&#39;</span> <span class="o">%</span> <span class="n">scope</span><span class="p">)</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/getImageBundleByContainerId.do?&#39;</span>
                             <span class="s1">&#39;containerId=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
                             <span class="s1">&#39;&amp;sessionScope=</span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">container_id</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scope</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_configlet_history"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlet_history">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlet_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the configlet history.</span>

<span class="sd">            Args:</span>
<span class="sd">                key (str): Key for the configlet.</span>
<span class="sd">                start (int): The first configlet entry to return.  Default is 0</span>
<span class="sd">                end (int): The last configlet entry to return.  Default is 0</span>
<span class="sd">                    which means to return all configlet entries.  Can be a</span>
<span class="sd">                    large number to indicate the last configlet entry.</span>

<span class="sd">            Returns:</span>
<span class="sd">                history (dict): The configlet dict with the changes from</span>
<span class="sd">                    most recent to oldest.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_configlets_history: key: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getConfigletHistory.do?configletId=&#39;</span>
                             <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&amp;queryparam=&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_inventory"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">get_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the a dict of the net elements known to CVP.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): The first inventory entry to return.  Default is 0</span>
<span class="sd">                end (int): The last inventory entry to return.  Default is 0</span>
<span class="sd">                    which means to return all inventory entries.  Can be a</span>
<span class="sd">                    large number to indicate the last inventory entry.</span>
<span class="sd">                query (string): A value that can be used as a match to filter</span>
<span class="sd">                    returned inventory list. For example get all switches that</span>
<span class="sd">                    are running a specific version of EOS.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_inventory: called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/getInventory.do?&#39;</span>
                                 <span class="s1">&#39;queryparam=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">qplus</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;netElementList&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/devices?provisioned=true&#39;</span><span class="p">,</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_containers</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;systemMacAddress&#39;</span><span class="p">]</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;deviceInfo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;deviceStatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;isMLAGEnabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;mlagEnabled&#39;</span><span class="p">]</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;isDANZEnabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;danzEnabled&#39;</span><span class="p">]</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;parentContainerId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;parentContainerKey&#39;</span><span class="p">]</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;bootupTimeStamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;bootupTimestamp&#39;</span><span class="p">]</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;internalBuildId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;internalBuild&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;taskIdList&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dev</span><span class="p">:</span>
                <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;taskIdList&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s1">&#39;tempAction&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dev</span><span class="p">:</span>
                <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;tempAction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;memTotal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;memFree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;sslConfigAvailable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;sslEnabledByCVP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;lastSyncUp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;netelement&#39;</span>
            <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;dcaKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">container_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;parentContainerKey&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]:</span>
                    <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;containerName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                    <span class="n">container_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">container_found</span><span class="p">:</span>
                <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;containerName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CvpApi.add_devices_to_inventory"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_devices_to_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">add_devices_to_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_list</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add a list of devices to the specified parent container.</span>

<span class="sd">            Args:</span>
<span class="sd">                device_list (list): A list of devices to be added in the</span>
<span class="sd">                    form of dictionaries. Each device dictionary should</span>
<span class="sd">                    contain the following information:</span>
<span class="sd">                    - device_ip (str): ip address of device we are adding</span>
<span class="sd">                    - parent_name (str): Parent container name</span>
<span class="sd">                    - parent_key (str): Parent container key</span>
<span class="sd">                wait (boolean): Specifies whether to allow a wait time for</span>
<span class="sd">                    devices to appear in inventory before moving them to</span>
<span class="sd">                    the specified container. Applies to v2 API only.</span>

<span class="sd">            Example device list:</span>
<span class="sd">                device_list = [</span>
<span class="sd">                    {</span>
<span class="sd">                        device_ip: &#39;10.10.10.1&#39;,</span>
<span class="sd">                        parent_name: &#39;Tenant&#39;,</span>
<span class="sd">                        parent_key: &#39;root&#39;</span>
<span class="sd">                    },</span>
<span class="sd">                    {</span>
<span class="sd">                        device_ip: &#39;10.10.10.2&#39;,</span>
<span class="sd">                        parent_name: &#39;MyContainer&#39;,</span>
<span class="sd">                        parent_key: &#39;container-id-1234&#39;</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;add_device_to_inventory: called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">device_list</span><span class="p">:</span>
                <span class="n">dev_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;containerName&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parent_name&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;containerId&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parent_key&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;containerType&#39;</span><span class="p">:</span> <span class="s1">&#39;Existing&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ipAddress&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;device_ip&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;containerList&#39;</span><span class="p">:</span> <span class="p">[]</span>
                <span class="p">}</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dev_data</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data_list</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/inventory/add/addToInventory.do?&#39;</span>
                           <span class="s1">&#39;startIndex=0&amp;endIndex=0&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>

            <span class="c1"># Create a list of device IPs</span>
            <span class="n">device_ips</span> <span class="o">=</span> <span class="p">[</span><span class="n">dev</span><span class="p">[</span><span class="s1">&#39;device_ip&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">device_list</span><span class="p">]</span>

            <span class="c1"># First add the devices to the inventory in a single call</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;hosts&#39;</span><span class="p">:</span> <span class="n">device_ips</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/inventory/devices&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>

            <span class="c1"># Get the inventory list</span>
            <span class="n">inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inventory</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
                <span class="c1"># With v2, the devices can take a few moments to appear</span>
                <span class="c1"># We need them present before we can move them to a container</span>
                <span class="n">timeout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">600</span>
                <span class="k">while</span> <span class="n">device_ips</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
                    <span class="n">inv_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">dev</span><span class="p">[</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">inv</span><span class="p">]</span>
                    <span class="n">device_ips</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">device_ips</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">inv_devices</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">device_ips</span><span class="p">:</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">inv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inventory</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">device_ips</span><span class="p">:</span>
                    <span class="c1"># If any devices did not appear, there is a problem</span>
                    <span class="c1"># Join the missing IPs into a string for output</span>
                    <span class="n">missing_ips</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_ips</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Devices </span><span class="si">{}</span><span class="s1"> failed to appear &#39;</span>
                                       <span class="s1">&#39;in inventory&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missing_ips</span><span class="p">))</span>

            <span class="c1"># Move the devices to their specified containers</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">device_list</span><span class="p">:</span>
                <span class="n">devs</span> <span class="o">=</span> <span class="p">[</span><span class="n">dev</span> <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">inv</span> <span class="k">if</span> <span class="s1">&#39;ipAddress&#39;</span> <span class="ow">in</span> <span class="n">dev</span> <span class="ow">and</span>
                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;device_ip&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">]]</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="n">devs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">container</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parent_key&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parent_name&#39;</span><span class="p">]}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">move_device_to_container</span><span class="p">(</span><span class="s1">&#39;add_device_to_inventory API v2&#39;</span><span class="p">,</span>
                                              <span class="n">dev</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.add_device_to_inventory"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_device_to_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">add_device_to_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                                <span class="n">parent_key</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add the device to the specified parent container.</span>

<span class="sd">            Args:</span>
<span class="sd">                device_ip (str): ip address of device we are adding</span>
<span class="sd">                parent_name (str): Parent container name</span>
<span class="sd">                parent_key (str): Parent container key</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Put parameters into a dictionary and call add_devices_to_inventory</span>
        <span class="n">device</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;device_ip&#39;</span><span class="p">:</span> <span class="n">device_ip</span><span class="p">,</span>
            <span class="s1">&#39;parent_name&#39;</span><span class="p">:</span> <span class="n">parent_name</span><span class="p">,</span>
            <span class="s1">&#39;parent_key&#39;</span><span class="p">:</span> <span class="n">parent_key</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_devices_to_inventory</span><span class="p">([</span><span class="n">device</span><span class="p">],</span> <span class="n">wait</span><span class="o">=</span><span class="n">wait</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.retry_add_to_inventory"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.retry_add_to_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">retry_add_to_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">,</span> <span class="n">device_ip</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span>
                               <span class="n">password</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Retry addition of device to Cvp inventory</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): MAC address of device</span>
<span class="sd">                device_ip (str): ip address assigned to device</span>
<span class="sd">                username (str): username for device login</span>
<span class="sd">                password (str): password for user</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;retry_add_to_inventory: called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">device_mac</span><span class="p">,</span>
                    <span class="s2">&quot;ipAddress&quot;</span><span class="p">:</span> <span class="n">device_ip</span><span class="p">,</span>
                    <span class="s2">&quot;userName&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/inventory/add/retryAddDeviceToInventory.do?&#39;</span>
                           <span class="s1">&#39;startIndex=0&amp;endIndex=0&#39;</span><span class="p">,</span>
                           <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;retry_add_to_inventory: not implemented for v2 APIs&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.delete_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_device">[docs]</a>    <span class="k">def</span> <span class="nf">delete_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delete the device and its pending tasks from Cvp inventory</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): mac address of device we are deleting</span>
<span class="sd">                                  For CVP 2020 this param is now required to</span>
<span class="sd">                                  be the device serial number instead of MAC</span>
<span class="sd">                                  address. This method will handle getting</span>
<span class="sd">                                  the device serial number via the provided</span>
<span class="sd">                                  MAC address.</span>
<span class="sd">            Returns:</span>
<span class="sd">                data (dict): Contains success or failure message</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;delete_device: called&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_devices</span><span class="p">([</span><span class="n">device_mac</span><span class="p">])</span></div>

<div class="viewcode-block" id="CvpApi.delete_devices"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_devices">[docs]</a>    <span class="k">def</span> <span class="nf">delete_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_macs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delete the device and its pending tasks from Cvp inventory</span>

<span class="sd">            Args:</span>
<span class="sd">                device_macs (list): list of mac address for</span>
<span class="sd">                                    devices we&#39;re deleting</span>
<span class="sd">                                    For CVP 2020 this param is now required to</span>
<span class="sd">                                    be a list of device serial numbers instead</span>
<span class="sd">                                    of MAC addresses. This method will handle</span>
<span class="sd">                                    getting the device serial number via the</span>
<span class="sd">                                    provided MAC address.</span>
<span class="sd">            Returns:</span>
<span class="sd">                data (dict): Contains success or failure message</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;delete_devices: called&#39;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">device_macs</span><span class="p">}</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/inventory/deleteDevices.do?&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;NOTE: The Delete Devices API has updated for&#39;</span>
                             <span class="s1">&#39; CVP 2020.2 and it is not required to send the&#39;</span>
                             <span class="s1">&#39; device serial number instead of mac address&#39;</span>
                             <span class="s1">&#39; when deleting a device. Looking up each devices&#39;</span>
                             <span class="s1">&#39;serial num based on provided MAC addresses&#39;</span><span class="p">)</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">dev_mac</span> <span class="ow">in</span> <span class="n">device_macs</span><span class="p">:</span>
                <span class="n">device_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_device_by_mac</span><span class="p">(</span><span class="n">dev_mac</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">device_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;serialNumber&#39;</span> <span class="ow">in</span> <span class="n">device_info</span><span class="p">:</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_info</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_devices_by_serial</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="CvpApi.delete_devices_by_serial"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_devices_by_serial">[docs]</a>    <span class="k">def</span> <span class="nf">delete_devices_by_serial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devices</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delete the device and its pending tasks from Cvp inventory</span>

<span class="sd">            Args:</span>
<span class="sd">                devices (list): list of device objects to be deleted</span>

<span class="sd">            Returns:</span>
<span class="sd">                data (dict): Contains success or failure message</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">device_serials</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">device_serials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;serialNumber&#39;</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">device_serials</span><span class="p">}</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;/inventory/devices&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="CvpApi.get_non_connected_device_count"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_non_connected_device_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_non_connected_device_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns number of devices not accessible/connected in the temporary</span>
<span class="sd">           inventory.</span>

<span class="sd">            Returns:</span>
<span class="sd">                data (int): Number of temporary inventory devices not</span>
<span class="sd">                            accessible/connected</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_non_connected_device_count: called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;/inventory/add/getNonConnectedDeviceCount.do&#39;</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/devices?provisioned=false&#39;</span><span class="p">,</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="n">unprovisioned_devs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">dev</span> <span class="ow">and</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">unprovisioned_devs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">unprovisioned_devs</span></div>

<div class="viewcode-block" id="CvpApi.save_inventory"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.save_inventory">[docs]</a>    <span class="k">def</span> <span class="nf">save_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Saves Cvp inventory state</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;save_inventory: called&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/inventory/add/saveInventory.do&#39;</span><span class="p">,</span>
                                  <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Save Inventory not implemented/necessary for&#39;</span> <span class="o">+</span>\
                  <span class="s1">&#39; CVP 2018.2 and beyond&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CvpApi.get_devices_in_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_devices_in_container">[docs]</a>    <span class="k">def</span> <span class="nf">get_devices_in_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a dict of the devices under the named container.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): The name of the container to get devices from</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_devices_in_container: called&#39;</span><span class="p">)</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">container</span><span class="p">:</span>
            <span class="n">all_devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_inventory</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">all_devices</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parentContainerId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]:</span>
                    <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">devices</span></div>

<div class="viewcode-block" id="CvpApi.get_device_by_name"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_device_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fqdn</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the net element device dict for the devices fqdn name.</span>

<span class="sd">            Args:</span>
<span class="sd">                fqdn (str): Fully qualified domain name of the device.</span>

<span class="sd">            Returns:</span>
<span class="sd">                device (dict): The net element device dict for the device if</span>
<span class="sd">                    otherwise returns an empty hash.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_device_by_name: fqdn: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fqdn</span><span class="p">)</span>
        <span class="c1"># data = self.get_inventory(start=0, end=0, query=fqdn)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_topology</span><span class="p">(</span><span class="n">fqdn</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;netElementList&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">netelem</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;netElementList&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">netelem</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">fqdn</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="n">netelem</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">device</span></div>

<div class="viewcode-block" id="CvpApi.get_device_by_mac"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_device_by_mac">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_by_mac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the net element device dict for the devices mac address.</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): MAC Address of the device.</span>

<span class="sd">            Returns:</span>
<span class="sd">                device (dict): The net element device dict for the device if</span>
<span class="sd">                    otherwise returns an empty hash.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_device_by_mac: MAC address: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">device_mac</span><span class="p">)</span>
        <span class="c1"># data = self.get_inventory(start=0, end=0, query=device_mac)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_topology</span><span class="p">(</span><span class="n">device_mac</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="s1">&#39;netElementList&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">netelem</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;netElementList&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">netelem</span><span class="p">[</span><span class="s1">&#39;systemMacAddress&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">device_mac</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="n">netelem</span>
                    <span class="k">break</span>
        <span class="k">return</span> <span class="n">device</span></div>

<div class="viewcode-block" id="CvpApi.get_device_configuration"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_device_configuration">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the running configuration for the device provided.</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): Mac address of the device to get the running</span>
<span class="sd">                    configuration for.</span>

<span class="sd">            Returns:</span>
<span class="sd">                device (dict): The net element device dict for the device if</span>
<span class="sd">                    otherwise returns an empty hash.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_device_configuration: device_mac: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">device_mac</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/getInventoryConfiguration.do?&#39;</span>
                                 <span class="s1">&#39;netElementId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">device_mac</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/device/config?&#39;</span>
                                 <span class="s1">&#39;netElementId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">device_mac</span><span class="p">,</span>
                                 <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="n">running_config</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;output&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">running_config</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">running_config</span></div>

<div class="viewcode-block" id="CvpApi.get_device_image_info"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_device_image_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_image_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return a dict of info about a device in CVP.</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): Mac address of the device to get the running</span>
<span class="sd">                    configuration for.</span>

<span class="sd">            Returns:</span>
<span class="sd">                device_image_info (dict): Dict of image info for the device</span>
<span class="sd">                    if found. Otherwise returns None.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Attempt to get net element data for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">device_mac</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">device_image_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;/provisioning/getNetElementInfoById.do?netElementId=</span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">device_mac</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CvpApiError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="c1"># Catch error when device for provided MAC is not found</span>
            <span class="k">if</span> <span class="s1">&#39;Invalid Netelement id&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Device with MAC </span><span class="si">%s</span><span class="s1"> not found&#39;</span> <span class="o">%</span> <span class="n">device_mac</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">return</span> <span class="n">device_image_info</span></div>

<div class="viewcode-block" id="CvpApi.get_containers"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_containers">[docs]</a>    <span class="k">def</span> <span class="nf">get_containers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of all the containers.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                containers (dict): The &#39;total&#39; key contains the number of</span>
<span class="sd">                containers, the &#39;data&#39; key contains a list of the containers</span>
<span class="sd">                with associated info.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Get list of containers&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/add/searchContainers.do?&#39;</span>
                                 <span class="s1">&#39;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
        <span class="n">containers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/inventory/containers&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span>
            <span class="n">full_cont_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container_by_id</span><span class="p">(</span>
                <span class="n">container</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">full_cont_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">container</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;root&#39;</span><span class="p">):</span>
                <span class="n">container</span><span class="p">[</span><span class="s1">&#39;parentName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_cont_info</span><span class="p">[</span><span class="s1">&#39;parentName&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">containers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cont</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">full_cont_info</span><span class="p">[</span><span class="s1">&#39;parentName&#39;</span><span class="p">]:</span>
                        <span class="n">container</span><span class="p">[</span><span class="s1">&#39;parentId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cont</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s1">&#39;No container parentId found for parentName </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">full_cont_info</span><span class="p">[</span><span class="s1">&#39;parentName&#39;</span><span class="p">])</span>
                    <span class="n">container</span><span class="p">[</span><span class="s1">&#39;parentId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">container</span><span class="p">[</span><span class="s1">&#39;parentName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">container</span><span class="p">[</span><span class="s1">&#39;parentId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">21</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;factoryId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;userId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">container</span><span class="p">[</span><span class="s1">&#39;childContainerId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">containers</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">containers</span><span class="p">)}</span></div>

<div class="viewcode-block" id="CvpApi.get_container_by_name"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_container_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_container_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a container that exactly matches the name.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): String to search for in container names.</span>

<span class="sd">            Returns:</span>
<span class="sd">                container (dict): Container info in dictionary format or None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Get info for container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">conts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/searchTopology.do?queryParam=</span><span class="si">%s</span><span class="s1">&#39;</span>
                              <span class="s1">&#39;&amp;startIndex=0&amp;endIndex=0&#39;</span> <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">conts</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">conts</span><span class="p">[</span><span class="s1">&#39;containerList&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">conts</span><span class="p">[</span><span class="s1">&#39;containerList&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">cont</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">cont</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.get_container_by_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_container_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_container_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a container for the given id.</span>

<span class="sd">            Args:</span>
<span class="sd">                key (str): String ID for container to find.</span>

<span class="sd">            Returns:</span>
<span class="sd">                container (dict): Container info in dictionary format or None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Get info for container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/getContainerInfoById.do?&#39;</span>
                             <span class="s1">&#39;containerId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>

<div class="viewcode-block" id="CvpApi.get_configlets_by_device_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_configlets_by_device_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_configlets_by_device_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the list of configlets applied to a device.</span>

<span class="sd">            Args:</span>
<span class="sd">                mac (str): Device mac address (i.e. device id)</span>
<span class="sd">                start (int): The first configlet entry to return.  Default is 0</span>
<span class="sd">                end (int): The last configlet entry to return.  Default is 0</span>
<span class="sd">                    which means to return all configlet entries.  Can be a</span>
<span class="sd">                    large number to indicate the last configlet entry.</span>

<span class="sd">            Returns:</span>
<span class="sd">                configlets (list): The list of configlets applied to the device</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_configlets_by_device: mac: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mac</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/getConfigletsByNetElementId.do?&#39;</span>
                             <span class="s1">&#39;netElementId=</span><span class="si">%s</span><span class="s1">&amp;queryParam=&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;&#39;</span>
                             <span class="s1">&#39;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;configletList&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CvpApi.add_configlet_builder"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_configlet_builder">[docs]</a>    <span class="k">def</span> <span class="nf">add_configlet_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">draft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add a confilget builder and return the key for the configlet builder.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): Configlet builder name</span>
<span class="sd">                config (str): Python configlet builder code</span>
<span class="sd">                draft (bool): If builder is a draft</span>
<span class="sd">                form (list): Array/list of form data</span>
<span class="sd">                    Parameters:</span>
<span class="sd">                        fieldId (str):</span>
<span class="sd">                        fieldLabel (str):</span>
<span class="sd">                        value (str):</span>
<span class="sd">                        type (str): {</span>
<span class="sd">                            &#39;Text box&#39;,</span>
<span class="sd">                            &#39;Text area&#39;,</span>
<span class="sd">                            &#39;Drop down&#39;,</span>
<span class="sd">                            &#39;Check box&#39;,</span>
<span class="sd">                            &#39;Radio button&#39;,</span>
<span class="sd">                            &#39;IP address&#39;,</span>
<span class="sd">                            &#39;Password&#39;</span>
<span class="sd">                        }</span>
<span class="sd">                        validation:</span>
<span class="sd">                            mandatory (boolean):</span>
<span class="sd">                        helpText (str)</span>

<span class="sd">            Returns:</span>
<span class="sd">                key (str): The key for the configlet</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="p">:</span>
            <span class="n">form</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;add_configlet_builder: name: </span><span class="si">%s</span><span class="s1"> config: </span><span class="si">%s</span><span class="s1"> form: </span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">form</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;formList&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span>
                         <span class="s1">&#39;main_script&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">}}}</span>
        <span class="c1"># Create the configlet builder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/configlet/addConfigletBuilder.do?isDraft=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">draft</span><span class="p">,</span>
                       <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>

        <span class="c1"># Get the key for the configlet</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;/configlet/getConfigletByName.do?name=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CvpApi.add_configlet"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_configlet">[docs]</a>    <span class="k">def</span> <span class="nf">add_configlet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add a configlet and return the key for the configlet.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): Configlet name</span>
<span class="sd">                config (str): Switch config statements</span>

<span class="sd">            Returns:</span>
<span class="sd">                key (str): The key for the configlet</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;add_configlet: name: </span><span class="si">%s</span><span class="s1"> config: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">}</span>
        <span class="c1"># Create the configlet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/configlet/addConfiglet.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                       <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>

        <span class="c1"># Get the key for the configlet</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getConfigletByName.do?name=</span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CvpApi.delete_configlet"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_configlet">[docs]</a>    <span class="k">def</span> <span class="nf">delete_configlet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Delete the configlet.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): Configlet name</span>
<span class="sd">                key (str): Configlet key</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;delete_configlet: name: </span><span class="si">%s</span><span class="s1"> key: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">}]</span>
        <span class="c1"># Delete the configlet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/configlet/deleteConfiglet.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                       <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.update_configlet"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.update_configlet">[docs]</a>    <span class="k">def</span> <span class="nf">update_configlet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">wait_task_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Update a configlet.</span>

<span class="sd">            Args:</span>
<span class="sd">                config (str): Switch config statements</span>
<span class="sd">                key (str): Configlet key</span>
<span class="sd">                name (str): Configlet name</span>
<span class="sd">                wait_task_ids (boolean): Wait for task IDs to generate</span>

<span class="sd">            Returns:</span>
<span class="sd">                data (dict): Contains success or failure message</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;update_configlet: config: </span><span class="si">%s</span><span class="s1"> key: </span><span class="si">%s</span><span class="s1"> name: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="c1"># Update the configlet</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;waitForTaskIds&#39;</span><span class="p">:</span> <span class="n">wait_task_ids</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/configlet/updateConfiglet.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.add_note_to_configlet"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_note_to_configlet">[docs]</a>    <span class="k">def</span> <span class="nf">add_note_to_configlet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">note</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add a note to a configlet.</span>

<span class="sd">            Args:</span>
<span class="sd">                key (str): Configlet key</span>
<span class="sd">                note (str): Note to be added to configlet.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
            <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="n">note</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/configlet/addNoteToConfiglet.do&#39;</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.validate_config"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.validate_config">[docs]</a>    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Validate a config against a device</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): Device MAC address</span>
<span class="sd">                config (str): Switch config statements</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains the result of the</span>
<span class="sd">                    validation operation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;validate_config: name: </span><span class="si">%s</span><span class="s1"> config: </span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">device_mac</span><span class="p">,</span> <span class="n">config</span><span class="p">))</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;netElementId&#39;</span><span class="p">:</span> <span class="n">device_mac</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">}</span>
        <span class="c1"># Invoke the validate API call</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/configlet/validateConfig.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="n">validated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s1">&#39;warningCount&#39;</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">warning</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;warnings&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Validation of config produced warning - </span><span class="si">%s</span><span class="s1">&#39;</span>
                                 <span class="o">%</span> <span class="n">warning</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;errorCount&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Validation of config produced </span><span class="si">%s</span><span class="s1"> errors&#39;</span>
                           <span class="o">%</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;errorCount&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s1">&#39;errors&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Validation of config produced error - </span><span class="si">%s</span><span class="s1">&#39;</span>
                                   <span class="o">%</span> <span class="n">error</span><span class="p">)</span>
            <span class="n">validated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s1">&#39;result&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;messages&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Validation of config returned&#39;</span>
                                      <span class="s1">&#39; message - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">validated</span></div>

<div class="viewcode-block" id="CvpApi.get_all_temp_actions"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_all_temp_actions">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_temp_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of existing temp actions.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a list of the current</span>
<span class="sd">                    temp actions.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/provisioning/getAllTempActions.do?startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
               <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CvpApi._add_temp_action"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi._add_temp_action">[docs]</a>    <span class="k">def</span> <span class="nf">_add_temp_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Adds temp action that requires a saveTopology call to take effect.</span>

<span class="sd">            Args:</span>
<span class="sd">                data (dict): a data dict with a specific format for the</span>
<span class="sd">                    desired action.</span>

<span class="sd">                    Base Ex: data = {&#39;data&#39;: [{specific key/value pairs}]}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/provisioning/addTempAction.do?&#39;</span>
               <span class="s1">&#39;format=topology&amp;queryParam=&amp;nodeId=root&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi._save_topology_v2"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi._save_topology_v2">[docs]</a>    <span class="k">def</span> <span class="nf">_save_topology_v2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Confirms a previously created temp action.</span>

<span class="sd">            Args:</span>
<span class="sd">                data (list): a list that contains a dict with a specific</span>
<span class="sd">                    format for the desired action. Our primary use case is for</span>
<span class="sd">                    confirming existing temp actions so we most often send an</span>
<span class="sd">                    empty list to confirm an existing temp action.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: []}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;/provisioning/v2/saveTopology.do&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.apply_configlets_to_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.apply_configlets_to_device">[docs]</a>    <span class="k">def</span> <span class="nf">apply_configlets_to_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">new_configlets</span><span class="p">,</span>
                                   <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Apply the configlets to the device.</span>

<span class="sd">            Args:</span>
<span class="sd">                app_name (str): The application name to use in info field.</span>
<span class="sd">                dev (dict): The switch device dict</span>
<span class="sd">                new_configlets (list): List of configlet name and key pairs</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;apply_configlets_to_device: dev: </span><span class="si">%s</span><span class="s1"> names: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">new_configlets</span><span class="p">))</span>
        <span class="c1"># Get all the configlets assigned to the device.</span>
        <span class="n">configlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_configlets_by_device_id</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="s1">&#39;systemMacAddress&#39;</span><span class="p">])</span>

        <span class="c1"># Get a list of the names and keys of the configlets</span>
        <span class="n">cnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ckeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">configlet</span> <span class="ow">in</span> <span class="n">configlets</span><span class="p">:</span>
            <span class="n">cnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">ckeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="c1"># Add the new configlets to the end of the arrays</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">new_configlets</span><span class="p">:</span>
            <span class="n">cnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">ckeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Configlet Assign: to Device </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">app_name</span><span class="p">,</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">])</span>
        <span class="n">info_preview</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Configlet Assign:&lt;/b&gt; to Device&#39;</span> <span class="o">+</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info_preview</span><span class="p">,</span>
                          <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;associate&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;configlet&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;configletList&#39;</span><span class="p">:</span> <span class="n">ckeys</span><span class="p">,</span>
                          <span class="s1">&#39;configletNamesList&#39;</span><span class="p">:</span> <span class="n">cnames</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;configletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;configletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;systemMacAddress&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;netelement&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;nodeIpAddress&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;nodeTargetIpAddress&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;apply_configlets_to_device: saveTopology data:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># pylint: disable=too-many-locals</span>
<div class="viewcode-block" id="CvpApi.remove_configlets_from_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.remove_configlets_from_device">[docs]</a>    <span class="k">def</span> <span class="nf">remove_configlets_from_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">del_configlets</span><span class="p">,</span>
                                      <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove the configlets from the device.</span>

<span class="sd">            Args:</span>
<span class="sd">                app_name (str): The application name to use in info field.</span>
<span class="sd">                dev (dict): The switch device dict</span>
<span class="sd">                del_configlets (list): List of configlet name and key pairs</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;35&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;remove_configlets_from_device: dev: </span><span class="si">%s</span><span class="s1"> names: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">del_configlets</span><span class="p">))</span>

        <span class="c1"># Get all the configlets assigned to the device.</span>
        <span class="n">configlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_configlets_by_device_id</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="s1">&#39;systemMacAddress&#39;</span><span class="p">])</span>

        <span class="c1"># Get a list of the names and keys of the configlets.  Do not add</span>
        <span class="c1"># configlets that are on the delete list.</span>
        <span class="n">keep_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keep_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">configlet</span> <span class="ow">in</span> <span class="n">configlets</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">next</span><span class="p">((</span><span class="n">ent</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">del_configlets</span> <span class="k">if</span> <span class="n">ent</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">keep_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="n">keep_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1"># Remove the names and keys of the configlets to keep and build a</span>
        <span class="c1"># list of the configlets to remove.</span>
        <span class="n">del_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">del_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">del_configlets</span><span class="p">:</span>
            <span class="n">del_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">del_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Configlet Remove: from Device </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">app_name</span><span class="p">,</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">])</span>
        <span class="n">info_preview</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Configlet Remove:&lt;/b&gt; from Device&#39;</span> <span class="o">+</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info_preview</span><span class="p">,</span>
                          <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;associate&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;configlet&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;configletList&#39;</span><span class="p">:</span> <span class="n">keep_keys</span><span class="p">,</span>
                          <span class="s1">&#39;configletNamesList&#39;</span><span class="p">:</span> <span class="n">keep_names</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletNamesList&#39;</span><span class="p">:</span> <span class="n">del_names</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletList&#39;</span><span class="p">:</span> <span class="n">del_keys</span><span class="p">,</span>
                          <span class="s1">&#39;configletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;configletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;systemMacAddress&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;netelement&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;nodeIpAddress&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;nodeTargetIpAddress&#39;</span><span class="p">:</span> <span class="n">dev</span><span class="p">[</span><span class="s1">&#39;ipAddress&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;remove_configlets_from_device: saveTopology data:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.apply_configlets_to_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.apply_configlets_to_container">[docs]</a>    <span class="k">def</span> <span class="nf">apply_configlets_to_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
                                      <span class="n">new_configlets</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Apply the configlets to the container.</span>

<span class="sd">            Args:</span>
<span class="sd">                app_name (str): The application name to use in info field.</span>
<span class="sd">                container (dict): The container dict</span>
<span class="sd">                new_configlets (list): List of configlet name and key pairs</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;apply_configlets_to_container: container: </span><span class="si">%s</span><span class="s1"> names: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">new_configlets</span><span class="p">))</span>
        <span class="c1"># Get all the configlets assigned to the device.</span>
        <span class="n">configlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_configlets_by_container_id</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="c1"># Get a list of the names and keys of the configlets</span>
        <span class="c1"># Static Configlets</span>
        <span class="n">cnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ckeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># ConfigletBuilder Configlets</span>
        <span class="n">bnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bkeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">configlets</span><span class="p">[</span><span class="s1">&#39;configletList&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">configlet</span> <span class="ow">in</span> <span class="n">configlets</span><span class="p">[</span><span class="s1">&#39;configletList&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Static&#39;</span><span class="p">:</span>
                    <span class="n">cnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">ckeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Builder&#39;</span><span class="p">:</span>
                    <span class="n">bnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                    <span class="n">bkeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

                    <span class="c1"># Add the new configlets to the end of the arrays</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">new_configlets</span><span class="p">:</span>
            <span class="n">cnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">ckeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: Configlet Assign: to Container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">app_name</span><span class="p">,</span>
                                                          <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">info_preview</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Configlet Assign:&lt;/b&gt; to Container&#39;</span> <span class="o">+</span> <span class="n">container</span><span class="p">[</span>
            <span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info_preview</span><span class="p">,</span>
                          <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;associate&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;configlet&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;configletList&#39;</span><span class="p">:</span> <span class="n">ckeys</span><span class="p">,</span>
                          <span class="s1">&#39;configletNamesList&#39;</span><span class="p">:</span> <span class="n">cnames</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;configletBuilderList&#39;</span><span class="p">:</span> <span class="n">bkeys</span><span class="p">,</span>
                          <span class="s1">&#39;configletBuilderNamesList&#39;</span><span class="p">:</span> <span class="n">bnames</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;nodeIpAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeTargetIpAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;apply_configlets_to_container: saveTopology data:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="c1"># pylint: disable=too-many-locals</span>
    <span class="c1"># pylint: disable=invalid-name</span>
<div class="viewcode-block" id="CvpApi.remove_configlets_from_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.remove_configlets_from_container">[docs]</a>    <span class="k">def</span> <span class="nf">remove_configlets_from_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
                                         <span class="n">del_configlets</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove the configlets from the container.</span>

<span class="sd">            Args:</span>
<span class="sd">                app_name (str): The application name to use in info field.</span>
<span class="sd">                container (dict): The container dict</span>
<span class="sd">                del_configlets (list): List of configlet name and key pairs</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;35&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;remove_configlets_from_container: container: </span><span class="si">%s</span><span class="s1"> names: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">del_configlets</span><span class="p">))</span>

        <span class="c1"># Get all the configlets assigned to the device.</span>
        <span class="n">configlets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_configlets_by_container_id</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="c1"># Get a list of the names and keys of the configlets.  Do not add</span>
        <span class="c1"># configlets that are on the delete list.</span>
        <span class="n">keep_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">keep_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">configlet</span> <span class="ow">in</span> <span class="n">configlets</span><span class="p">[</span><span class="s1">&#39;configletList&#39;</span><span class="p">]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">next</span><span class="p">((</span><span class="n">ent</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">del_configlets</span> <span class="k">if</span> <span class="n">ent</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">),</span>
                    <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">keep_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">configlet</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
                <span class="n">keep_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="c1"># Remove the names and keys of the configlets to keep and build a</span>
        <span class="c1"># list of the configlets to remove.</span>
        <span class="n">del_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">del_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">del_configlets</span><span class="p">:</span>
            <span class="n">del_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">del_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>

        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Configlet Remove: from Container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">app_name</span><span class="p">,</span>
                                                           <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">info_preview</span> <span class="o">=</span> <span class="s1">&#39;&lt;b&gt;Configlet Remove:&lt;/b&gt; from Container&#39;</span> <span class="o">+</span> <span class="n">container</span><span class="p">[</span>
            <span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info_preview</span><span class="p">,</span>
                          <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;associate&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;configlet&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;configletList&#39;</span><span class="p">:</span> <span class="n">keep_keys</span><span class="p">,</span>
                          <span class="s1">&#39;configletNamesList&#39;</span><span class="p">:</span> <span class="n">keep_names</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletNamesList&#39;</span><span class="p">:</span> <span class="n">del_names</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreConfigletList&#39;</span><span class="p">:</span> <span class="n">del_keys</span><span class="p">,</span>
                          <span class="s1">&#39;configletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;configletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;ignoreConfigletBuilderNamesList&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;nodeIpAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeTargetIpAddress&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;remove_configlets_from_container: saveTopology data:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CvpApi.validate_configlets_for_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.validate_configlets_for_device">[docs]</a>    <span class="k">def</span> <span class="nf">validate_configlets_for_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mac</span><span class="p">,</span> <span class="n">configlet_keys</span><span class="p">,</span>
                                       <span class="n">page_type</span><span class="o">=</span><span class="s1">&#39;viewConfig&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Validate and compare configlets for device.</span>

<span class="sd">            Args:</span>
<span class="sd">                mac (str): MAC address of device to validate configlets for.</span>
<span class="sd">                configlet_keys (list): List of configlet keys</span>
<span class="sd">                page_type (list): Possible Values of pageType - &#39;viewConfig&#39;,</span>
<span class="sd">                    &#39;managementIPValidation&#39;, &#39;validateConfig&#39;, etc...</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains ...</span>

<span class="sd">                    Ex: {&quot;reconciledConfig&quot;: {...},</span>
<span class="sd">                         &quot;reconcile&quot;: 0,</span>
<span class="sd">                         &quot;new&quot;: 0,</span>
<span class="sd">                         &quot;designedConfig&quot;: [{...}],</span>
<span class="sd">                         &quot;total&quot;: 0,</span>
<span class="sd">                         &quot;runningConfig&quot;: [{...}],</span>
<span class="sd">                         &quot;isReconcileInvoked&quot;: true,</span>
<span class="sd">                         &quot;mismatch&quot;: 0,</span>
<span class="sd">                         &quot;warnings&quot;: [&quot;&quot;],</span>
<span class="sd">                         &quot;errors&quot;: [{&quot;configletLineNo&quot;: 0,</span>
<span class="sd">                                     &quot;error&quot;: &quot;string&quot;,</span>
<span class="sd">                                     &quot;configletId&quot;: &quot;string&quot;}, ...]</span>
<span class="sd">                        }</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;validate_configlets_for_device: &#39;</span>
                       <span class="s1">&#39;MAC: </span><span class="si">%s</span><span class="s1"> - conf keys: </span><span class="si">%s</span><span class="s1"> - page_type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">configlet_keys</span><span class="p">,</span> <span class="n">page_type</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;configIdList&#39;</span><span class="p">:</span> <span class="n">configlet_keys</span><span class="p">,</span>
                <span class="s1">&#39;netElementId&#39;</span><span class="p">:</span> <span class="n">mac</span><span class="p">,</span>
                <span class="s1">&#39;pageType&#39;</span><span class="p">:</span> <span class="n">page_type</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;/provisioning/v2/validateAndCompareConfiglets.do&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_applied_devices"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_applied_devices">[docs]</a>    <span class="k">def</span> <span class="nf">get_applied_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configlet_name</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of devices to which the named configlet is applied.</span>

<span class="sd">            Args:</span>
<span class="sd">                configlet_name (str): The name of the configlet to be queried.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getAppliedDevices.do?&#39;</span>
                             <span class="s1">&#39;configletName=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">configlet_name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_applied_containers"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_applied_containers">[docs]</a>    <span class="k">def</span> <span class="nf">get_applied_containers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configlet_name</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of containers to which the named</span>
<span class="sd">            configlet is applied.</span>

<span class="sd">            Args:</span>
<span class="sd">                configlet_name (str): The name of the configlet to be queried.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/configlet/getAppliedContainers.do?&#39;</span>
                             <span class="s1">&#39;configletName=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">configlet_name</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

    <span class="c1"># pylint: disable=too-many-arguments</span>
<div class="viewcode-block" id="CvpApi._container_op"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi._container_op">[docs]</a>    <span class="k">def</span> <span class="nf">_container_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">container_key</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                      <span class="n">parent_key</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Perform the operation on the container.</span>

<span class="sd">            Args:</span>
<span class="sd">                container_name (str): Container name</span>
<span class="sd">                container_key (str): Container key, can be empty for add.</span>
<span class="sd">                parent_name (str): Parent container name</span>
<span class="sd">                parent_key (str): Parent container key</span>
<span class="sd">                operation (str): Container operation &#39;add&#39; or &#39;delete&#39;.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: []}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> container </span><span class="si">%s</span><span class="s1"> under container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
               <span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">operation</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="n">container_key</span><span class="p">,</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="n">container_name</span><span class="p">,</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">}]}</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;toId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_key</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;toName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_name</span>
        <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;fromId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_key</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;fromName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_name</span>

        <span class="c1"># Perform the container operation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span></div>

<div class="viewcode-block" id="CvpApi.add_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_container">[docs]</a>    <span class="k">def</span> <span class="nf">add_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add the container to the specified parent.</span>

<span class="sd">            Args:</span>
<span class="sd">                container_name (str): Container name</span>
<span class="sd">                parent_name (str): Parent container name</span>
<span class="sd">                parent_key (str): Parent container key</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: []}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;add_container: container: </span><span class="si">%s</span><span class="s1"> parent: </span><span class="si">%s</span><span class="s1"> parent_key: </span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">container_name</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span> <span class="n">parent_key</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container_op</span><span class="p">(</span><span class="n">container_name</span><span class="p">,</span> <span class="s1">&#39;new_container&#39;</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                                  <span class="n">parent_key</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.delete_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_container">[docs]</a>    <span class="k">def</span> <span class="nf">delete_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">container_key</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                         <span class="n">parent_key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add the container to the specified parent.</span>

<span class="sd">            Args:</span>
<span class="sd">                container_name (str): Container name</span>
<span class="sd">                container_key (str): Container key</span>
<span class="sd">                parent_name (str): Parent container name</span>
<span class="sd">                parent_key (str): Parent container key</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: []}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;delete_container: container: </span><span class="si">%s</span><span class="s1"> container_key: </span><span class="si">%s</span><span class="s1"> &#39;</span>
                       <span class="s1">&#39;parent: </span><span class="si">%s</span><span class="s1"> parent_key: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">container_name</span><span class="p">,</span> <span class="n">container_key</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                        <span class="n">parent_key</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_container_op</span><span class="p">(</span><span class="n">container_name</span><span class="p">,</span> <span class="n">container_key</span><span class="p">,</span> <span class="n">parent_name</span><span class="p">,</span>
                                  <span class="n">parent_key</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_parent_container_for_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_parent_container_for_device">[docs]</a>    <span class="k">def</span> <span class="nf">get_parent_container_for_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device_mac</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add the container to the specified parent.</span>

<span class="sd">            Args:</span>
<span class="sd">                device_mac (str): Device mac address</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains the parent container info</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_parent_container_for_device: called for </span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="n">device_mac</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/searchTopology.do?&#39;</span>
                             <span class="s1">&#39;queryParam=</span><span class="si">%s</span><span class="s1">&amp;startIndex=0&amp;endIndex=0&#39;</span>
                             <span class="o">%</span> <span class="n">device_mac</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cont_name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;netElementContainerList&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;containerName&#39;</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container_by_name</span><span class="p">(</span><span class="n">cont_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.move_device_to_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.move_device_to_container">[docs]</a>    <span class="k">def</span> <span class="nf">move_device_to_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
                                 <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add the container to the specified parent.</span>

<span class="sd">            Args:</span>
<span class="sd">                app_name (str): String to specify info/signifier of calling app</span>
<span class="sd">                device (dict): Device info</span>
<span class="sd">                container (dict): Container info</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: []}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> moving device </span><span class="si">%s</span><span class="s1"> to container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">app_name</span><span class="p">,</span>
                                                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                                                        <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Attempting to move device </span><span class="si">%s</span><span class="s1"> to container </span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="s1">&#39;parentContainerId&#39;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span>
            <span class="n">from_id</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parentContainerId&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent_container_for_device</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
            <span class="n">from_id</span> <span class="o">=</span> <span class="n">parent_cont</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;netelement&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># pylint: disable=invalid-name</span>
        <span class="k">except</span> <span class="n">CvpApiError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Data already exists&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Device </span><span class="si">%s</span><span class="s1"> already in container </span><span class="si">%s</span><span class="s1">&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span> <span class="n">container</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.search_topology"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.search_topology">[docs]</a>    <span class="k">def</span> <span class="nf">search_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Search the topology for items matching the query parameter.</span>

<span class="sd">            Args:</span>
<span class="sd">                query (str): Query parameter which is the name of the container</span>
<span class="sd">                    or device.</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains the container and</span>
<span class="sd">                    netelement lists.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;search_topology: query: </span><span class="si">%s</span><span class="s1"> start: </span><span class="si">%d</span><span class="s1"> end: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/searchTopology.do?queryParam=</span><span class="si">%s</span><span class="s1">&amp;&#39;</span>
                             <span class="s1">&#39;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">qplus</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;netElementList&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;netElementList&#39;</span><span class="p">]:</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;deviceStatus&#39;</span><span class="p">]</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;mlagEnabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;isMLAGEnabled&#39;</span><span class="p">]</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;danzEnabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;isDANZEnabled&#39;</span><span class="p">]</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parentContainerKey&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parentContainerId&#39;</span><span class="p">]</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;bootupTimestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;bootupTimeStamp&#39;</span><span class="p">]</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;internalBuild&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;internalBuildId&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="CvpApi.filter_topology"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.filter_topology">[docs]</a>    <span class="k">def</span> <span class="nf">filter_topology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="o">=</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;topology&#39;</span><span class="p">,</span>
                        <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Filter the CVP topology for container and device information.</span>

<span class="sd">            Args:</span>
<span class="sd">                node_id (str): The container key to base the filter in.</span>
<span class="sd">                    Default is &#39;root&#39;, for the Tenant container.</span>
<span class="sd">                fmt (str): The type of filter to return. Must be either</span>
<span class="sd">                    &#39;topology&#39; or &#39;list&#39;. Default is &#39;topology&#39;.</span>
<span class="sd">                start (int): Start index for the pagination. Default is 0.</span>
<span class="sd">                end (int): End index for the pagination. If end index is 0</span>
<span class="sd">                    then all the records will be returned. Default is 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/provisioning/filterTopology.do?nodeId=</span><span class="si">%s</span><span class="s1">&amp;&#39;</span>
               <span class="s1">&#39;format=</span><span class="si">%s</span><span class="s1">&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span>
               <span class="o">%</span> <span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.check_compliance"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.check_compliance">[docs]</a>    <span class="k">def</span> <span class="nf">check_compliance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_key</span><span class="p">,</span> <span class="n">node_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Check that a device is in compliance, that is the configlets</span>
<span class="sd">            applied to the device match the devices running configuration.</span>

<span class="sd">            Args:</span>
<span class="sd">                node_key (str): The device key. This is the device MAC address</span>
<span class="sd">                    Example: ff:ff:ff:ff:ff:ff</span>
<span class="sd">                node_type (str): The device type. This is either &#39;netelement&#39;</span>
<span class="sd">                    or &#39;container&#39;</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains the results of the</span>
<span class="sd">                    compliance check.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;check_compliance: node_key: </span><span class="si">%s</span><span class="s1"> node_type: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                       <span class="p">(</span><span class="n">node_key</span><span class="p">,</span> <span class="n">node_type</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="n">node_key</span><span class="p">,</span> <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="n">node_type</span><span class="p">}</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/provisioning/checkCompliance.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;complianceIndication&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;complianceIndication&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;NONE&#39;</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="CvpApi.get_event_by_id"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_event_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return information on the requested event ID.</span>

<span class="sd">            Args:</span>
<span class="sd">                e_id (str): The event id to be queried.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/event/getEventById.do?eventId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e_id</span><span class="p">,</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_default_snapshot_template"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_default_snapshot_template">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_snapshot_template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return the default snapshot template.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;/snapshot/getDefaultSnapshotTemplate.do?&#39;</span>
                   <span class="s1">&#39;startIndex=0&amp;endIndex=0&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;API getDefaultSnapshotTemplate.do&#39;</span>
                       <span class="s1">&#39; deprecated for CVP 2018.2 and beyond&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># pylint: disable=invalid-name</span>
<div class="viewcode-block" id="CvpApi.capture_container_level_snapshot"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.capture_container_level_snapshot">[docs]</a>    <span class="k">def</span> <span class="nf">capture_container_level_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_key</span><span class="p">,</span> <span class="n">container_key</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Initialize a container level snapshot event.</span>

<span class="sd">            Args:</span>
<span class="sd">                template_key (str): The snapshot template key to be used for</span>
<span class="sd">                    the snapshots.</span>
<span class="sd">                container_key (str): The container key to start the</span>
<span class="sd">                    snapshots on.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v1 Inventory API Call&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;templateId&#39;</span><span class="p">:</span> <span class="n">template_key</span><span class="p">,</span>
                <span class="s1">&#39;containerId&#39;</span><span class="p">:</span> <span class="n">container_key</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/snapshot/captureContainerLevelSnapshot.do&#39;</span><span class="p">,</span>
                                  <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 Inventory API Call&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;API captureContainerLevelSnapshot.do&#39;</span>
                       <span class="s1">&#39; deprecated for CVP 2018.2 and beyond&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.add_image"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_image">[docs]</a>    <span class="k">def</span> <span class="nf">add_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add an image to a CVP cluster.</span>

<span class="sd">            Args:</span>
<span class="sd">                filepath (str): Local path to the image to upload.</span>

<span class="sd">            Returns:</span>
<span class="sd">                data (dict): Dictionary of image add data.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Get the absolute file path to be uploaded</span>
        <span class="n">image_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/image/addImage.do&#39;</span><span class="p">,</span>
                                  <span class="n">files</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">image_data</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="CvpApi.cancel_image"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.cancel_image">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Discard/cancel the uploaded image/image bundle before save.</span>

<span class="sd">            Args:</span>
<span class="sd">                image_name (string): Name of image to cancel/discard.</span>

<span class="sd">            Returns:</span>
<span class="sd">                data (dict): Success or error message.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">image_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">image_name</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/image/cancelImages.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">image_data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_images"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_images">[docs]</a>    <span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return a list of all images.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                images (dict): The &#39;total&#39; key contains the number of images,</span>
<span class="sd">                    the &#39;data&#39; key contains a list of images and their info.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Get info about images&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/image/getImages.do?queryparam=&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;&#39;</span>
                             <span class="s1">&#39;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_image_bundles"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_image_bundles">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_bundles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return a list of all image bundles.</span>

<span class="sd">            Args:</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                image bundles (dict): The &#39;total&#39; key contains the number of</span>
<span class="sd">                    image bundles, the &#39;data&#39; key contains a list of image</span>
<span class="sd">                    bundles and their info.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Get image bundles that can be applied to devices or&#39;</span>
                       <span class="s1">&#39; containers&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/image/getImageBundles.do?queryparam=&amp;&#39;</span>
                             <span class="s1">&#39;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
                             <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_image_bundle_by_name"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_image_bundle_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_image_bundle_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return a dict of info about an image bundle.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): Name of image bundle to return info about.</span>

<span class="sd">            Returns:</span>
<span class="sd">                image bundle (dict): Dict of info specific to the image bundle</span>
<span class="sd">                    requested or None if the name requested doesn&#39;t exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Attempt to get image bundle </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/image/getImageBundleByName.do?name=</span><span class="si">%s</span><span class="s1">&#39;</span>
                                  <span class="o">%</span> <span class="n">qplus</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CvpApiError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="c1"># Catch an invalid task_id error and return None</span>
            <span class="k">if</span> <span class="s1">&#39;Entity does not exist&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Bundle with name </span><span class="si">%s</span><span class="s1"> does not exist&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">error</span>
        <span class="k">return</span> <span class="n">image</span></div>

<div class="viewcode-block" id="CvpApi.delete_image_bundle"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_image_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">delete_image_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_key</span><span class="p">,</span> <span class="n">image_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Delete image bundle</span>

<span class="sd">            Args:</span>
<span class="sd">                image_key (str): The key of the image bundle to be deleted.</span>
<span class="sd">                image_name (str): The name of the image bundle to be deleted.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">bundle_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">image_key</span><span class="p">,</span>
                      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">image_name</span><span class="p">}]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/image/deleteImageBundles.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">bundle_data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.save_image_bundle"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.save_image_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">save_image_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">certified</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Save an image bundle to a cluster.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (str): The name of the image bundle to be saved.</span>
<span class="sd">                images (list): A list of image names to include in the bundle.</span>
<span class="sd">                certified (bool): Whether the image bundle is certified or</span>
<span class="sd">                    not. Default is True.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">certified_image</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="n">certified</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;isCertifiedImage&#39;</span><span class="p">:</span> <span class="n">certified_image</span><span class="p">,</span>
            <span class="s1">&#39;images&#39;</span><span class="p">:</span> <span class="n">images</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/image/saveImageBundle.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.update_image_bundle"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.update_image_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">update_image_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">certified</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Update an existing image bundle</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">certified_image</span> <span class="o">=</span> <span class="s1">&#39;true&#39;</span> <span class="k">if</span> <span class="n">certified</span> <span class="k">else</span> <span class="s1">&#39;false&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">bundle_id</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;isCertifiedImage&#39;</span><span class="p">:</span> <span class="n">certified_image</span><span class="p">,</span>
            <span class="s1">&#39;images&#39;</span><span class="p">:</span> <span class="n">images</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/image/updateImageBundle.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.apply_image_to_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.apply_image_to_device">[docs]</a>    <span class="k">def</span> <span class="nf">apply_image_to_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Apply an image bundle to a device</span>

<span class="sd">            Args:</span>
<span class="sd">                image (dict): The image info.</span>
<span class="sd">                device (dict): Info about device to apply image to.</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any). Image updates will not run until</span>
<span class="sd">                    task or tasks are executed.</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_image_to_element</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                                           <span class="s1">&#39;netelement&#39;</span><span class="p">,</span> <span class="n">create_task</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.apply_image_to_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.apply_image_to_container">[docs]</a>    <span class="k">def</span> <span class="nf">apply_image_to_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Apply an image bundle to a container</span>

<span class="sd">            Args:</span>
<span class="sd">                image (dict): The image info.</span>
<span class="sd">                container (dict): Info about container to apply image to.</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any). Image updates will not run until</span>
<span class="sd">                    task or tasks are executed.</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_image_to_element</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                           <span class="s1">&#39;container&#39;</span><span class="p">,</span> <span class="n">create_task</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.apply_image_to_element"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.apply_image_to_element">[docs]</a>    <span class="k">def</span> <span class="nf">apply_image_to_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_type</span><span class="p">,</span>
                               <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Apply an image bundle to a device or container.</span>

<span class="sd">            Args:</span>
<span class="sd">                image (dict): The image info.</span>
<span class="sd">                element (dict): Info about element to apply image to. Dict</span>
<span class="sd">                    can contain device info or container info.</span>
<span class="sd">                name (str): Name of element image is being applied to.</span>
<span class="sd">                id_type (str): Id type of element image is being applied to.</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any). Image updates will not run until</span>
<span class="sd">                    task or tasks are executed.</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Attempt to apply </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                                         <span class="n">id_type</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;Apply image: </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">id_type</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;imageBundleKeys&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;imageBundleKeys&#39;</span><span class="p">]:</span>
                <span class="n">node_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;imageBundleKeys&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Provided image is an image object.&#39;</span>
                          <span class="s1">&#39; Using first value from imageBundleKeys - </span><span class="si">%s</span><span class="s1">&#39;</span>
                          <span class="o">%</span> <span class="n">node_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Provided image is an image bundle object.&#39;</span>
                          <span class="s1">&#39; Found v1 API id field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">node_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;key&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Provided image is an image bundle object.&#39;</span>
                          <span class="s1">&#39; Found v2 API key field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">node_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;associate&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;imagebundle&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="n">id_type</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.remove_image_from_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.remove_image_from_device">[docs]</a>    <span class="k">def</span> <span class="nf">remove_image_from_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove the image bundle from the specified device.</span>

<span class="sd">            Args:</span>
<span class="sd">                image (dict): The image info.</span>
<span class="sd">                device (dict): The device info.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_image_from_element</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                                              <span class="s1">&#39;netelement&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.remove_image_from_container"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.remove_image_from_container">[docs]</a>    <span class="k">def</span> <span class="nf">remove_image_from_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">container</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove the image bundle from the specified container.</span>

<span class="sd">            Args:</span>
<span class="sd">                image (dict): The image info.</span>
<span class="sd">                container (dict): The container info.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_image_from_element</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span>
                                              <span class="n">container</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.remove_image_from_element"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.remove_image_from_element">[docs]</a>    <span class="k">def</span> <span class="nf">remove_image_from_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Remove the image bundle from the specified container.</span>

<span class="sd">            Args:</span>
<span class="sd">                image (dict): The image info.</span>
<span class="sd">                element (dict): The container info.</span>
<span class="sd">                name (): name.</span>
<span class="sd">                id_type (): type.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Attempt to remove </span><span class="si">%s</span><span class="s1"> from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;Remove image: </span><span class="si">%s</span><span class="s1"> from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;imageBundleKeys&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;imageBundleKeys&#39;</span><span class="p">]:</span>
                <span class="n">node_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;imageBundleKeys&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Provided image is an image object.&#39;</span>
                          <span class="s1">&#39; Using first value from imageBundleKeys - </span><span class="si">%s</span><span class="s1">&#39;</span>
                          <span class="o">%</span> <span class="n">node_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Provided image is an image bundle object.&#39;</span>
                          <span class="s1">&#39; Found v1 API id field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">node_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;key&#39;</span> <span class="ow">in</span> <span class="n">image</span><span class="p">:</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Provided image is an image bundle object.&#39;</span>
                          <span class="s1">&#39; Found v2 API key field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">node_id</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;note&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;associate&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;imagebundle&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="n">element</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="n">id_type</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromName&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreNodeId&#39;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                          <span class="s1">&#39;ignoreNodeName&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span></div>

<div class="viewcode-block" id="CvpApi.get_change_controls"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_change_controls">[docs]</a>    <span class="k">def</span> <span class="nf">get_change_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of change controls.</span>

<span class="sd">            Args:</span>
<span class="sd">                query (str): Query to look for in change control names</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                change controls (list): The list of change controls</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_change_controls: query: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">query</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v3/v4/v5 getChangeControls API Call&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;get_change_controls: change control APIs moved for v3/v4/v5&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 getChangeControls API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;/changeControl/getChangeControls.do?searchText=</span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="s1">&#39;&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qplus</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CvpApi.change_control_available_tasks"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.change_control_available_tasks">[docs]</a>    <span class="k">def</span> <span class="nf">change_control_available_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns a list of tasks that are available for a change control.</span>

<span class="sd">            Args:</span>
<span class="sd">                query (str): Query to look for in task</span>
<span class="sd">                start (int): Start index for the pagination.  Default is 0.</span>
<span class="sd">                end (int): End index for the pagination.  If end index is 0</span>
<span class="sd">                    then all the records will be returned.  Default is 0.</span>

<span class="sd">            Returns:</span>
<span class="sd">                tasks (list): The list of available tasks</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;change_control_available_tasks: query: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">query</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;v3/v4/v5 uses existing get_task_by_status API Call&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tasks_by_status</span><span class="p">(</span><span class="s1">&#39;PENDING&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 getTasksByStatus API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;/changeControl/getTasksByStatus.do?searchText=</span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="s1">&#39;&amp;startIndex=</span><span class="si">%d</span><span class="s1">&amp;endIndex=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">qplus</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="CvpApi.create_change_control"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.create_change_control">[docs]</a>    <span class="k">def</span> <span class="nf">create_change_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">change_control_tasks</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span>
                              <span class="n">country_id</span><span class="p">,</span> <span class="n">date_time</span><span class="p">,</span> <span class="n">snapshot_template_key</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                              <span class="n">change_control_type</span><span class="o">=</span><span class="s1">&#39;Custom&#39;</span><span class="p">,</span>
                              <span class="n">stop_on_error</span><span class="o">=</span><span class="s1">&#39;false&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Create change control with provided information and return</span>
<span class="sd">            change control ID.</span>

<span class="sd">            Args:</span>
<span class="sd">                name (string): The name for the new change control.</span>
<span class="sd">                change_control_tasks (list): A list of key value pairs where</span>
<span class="sd">                    the key is the Task ID and the value is the task order</span>
<span class="sd">                    as an integer.</span>
<span class="sd">                    Ex: [{&#39;taskId&#39;: &#39;100&#39;, &#39;taskOrder&#39;: 1},</span>
<span class="sd">                         {&#39;taskId&#39;: &#39;101&#39;, &#39;taskOrder&#39;: 1},</span>
<span class="sd">                         {&#39;taskId&#39;: &#39;102&#39;, &#39;taskOrder&#39;: 2}]</span>
<span class="sd">                timezone (string): The timezone as a string.</span>
<span class="sd">                    Ex: &quot;America/New_York&quot;</span>
<span class="sd">                country_id (string): The country ID.</span>
<span class="sd">                    Ex: &quot;United States&quot;</span>
<span class="sd">                date_time (string): The date and time for execution.</span>
<span class="sd">                    Time is military time format.</span>
<span class="sd">                    Ex: &quot;2018-08-22 11:30&quot;</span>
<span class="sd">                snapshot_template_key (string): ???</span>
<span class="sd">                change_control_type (string): The type of change control being</span>
<span class="sd">                    created. Options are &quot;Custom&quot; or &quot;Rollback&quot;.</span>
<span class="sd">                stop_on_error (string): String representation of a boolean</span>
<span class="sd">                    to set whether this change control will stop if an error is</span>
<span class="sd">                    encountered in one of its tasks.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains...</span>

<span class="sd">                Ex: {&quot;data&quot;: &quot;success&quot;, &quot;ccId&quot;: &quot;4&quot;}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;create_change_control&#39;</span><span class="p">)</span>
        <span class="c1"># {</span>
        <span class="c1">#  &quot;timeZone&quot;: &quot;America/New_York&quot;,</span>
        <span class="c1">#  &quot;countryId&quot;: &quot;United States&quot;,</span>
        <span class="c1">#  &quot;dateTime&quot;: &quot;2018-08-22 11:30&quot;,</span>
        <span class="c1">#  &quot;ccName&quot;: &quot;test2&quot;,</span>
        <span class="c1">#  &quot;snapshotTemplateKey&quot;: &quot;&quot;,</span>
        <span class="c1">#  &quot;type&quot;: &quot;Custom&quot;,</span>
        <span class="c1">#  &quot;stopOnError&quot;: &quot;false&quot;,</span>
        <span class="c1">#  &quot;deletedTaskIds&quot;: [],</span>
        <span class="c1">#  &quot;changeControlTasks&quot;: [</span>
        <span class="c1">#    {</span>
        <span class="c1">#      &quot;taskId&quot;: &quot;126&quot;,</span>
        <span class="c1">#      &quot;taskOrder&quot;: 1,</span>
        <span class="c1">#      &quot;snapshotTemplateKey&quot;: &quot;&quot;,</span>
        <span class="c1">#      &quot;clonedCcId&quot;: &quot;&quot;</span>
        <span class="c1">#    }</span>
        <span class="c1">#  ]</span>
        <span class="c1"># }</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v3/v4/v5 addOrUpdateChangeControl API Call&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;create_change_control:&#39;</span>
                             <span class="s1">&#39; change control APIs moved for v3/v4/v5&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 addOrUpdateChangeControl API Call&#39;</span><span class="p">)</span>
        <span class="n">task_data_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task_info</span> <span class="ow">in</span> <span class="n">change_control_tasks</span><span class="p">:</span>
            <span class="n">task_list_entry</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;taskId&#39;</span><span class="p">:</span> <span class="n">task_info</span><span class="p">[</span><span class="s1">&#39;taskId&#39;</span><span class="p">],</span>
                               <span class="s1">&#39;taskOrder&#39;</span><span class="p">:</span> <span class="n">task_info</span><span class="p">[</span><span class="s1">&#39;taskOrder&#39;</span><span class="p">],</span>
                               <span class="s1">&#39;snapshotTemplateKey&#39;</span><span class="p">:</span> <span class="n">snapshot_template_key</span><span class="p">,</span>
                               <span class="s1">&#39;clonedCcId&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
            <span class="n">task_data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_list_entry</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timeZone&#39;</span><span class="p">:</span> <span class="n">timezone</span><span class="p">,</span>
                <span class="s1">&#39;countryId&#39;</span><span class="p">:</span> <span class="n">country_id</span><span class="p">,</span>
                <span class="s1">&#39;dateTime&#39;</span><span class="p">:</span> <span class="n">date_time</span><span class="p">,</span>
                <span class="s1">&#39;ccName&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;snapshotTemplateKey&#39;</span><span class="p">:</span> <span class="n">snapshot_template_key</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">change_control_type</span><span class="p">,</span>
                <span class="s1">&#39;stopOnError&#39;</span><span class="p">:</span> <span class="n">stop_on_error</span><span class="p">,</span>
                <span class="s1">&#39;deletedTaskIds&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;changeControlTasks&#39;</span><span class="p">:</span> <span class="n">task_data_list</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/changeControl/addOrUpdateChangeControl.do&#39;</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.create_change_control_v3"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.create_change_control_v3">[docs]</a>    <span class="k">def</span> <span class="nf">create_change_control_v3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Create change control with provided information and return</span>
<span class="sd">            change control ID.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): The ID for the new change control.</span>
<span class="sd">                name (string): The name for the new change control.</span>
<span class="sd">                tasks (list): A list of Task IDs as strings</span>
<span class="sd">                    Ex: [&#39;10&#39;, &#39;11&#39;, &#39;12&#39;]</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains...</span>

<span class="sd">                Ex: [{u&#39;id&#39;: u&#39;cc_id&#39;,</span>
<span class="sd">                      u&#39;update_timestamp&#39;: u&#39;...&#39;}]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;create_change_control_v3&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Wrong method for API version </span><span class="si">%s</span><span class="s1">.&#39;</span>
                           <span class="s1">&#39; Use create_change_control method&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;create_change_control_v3:&#39;</span>
                             <span class="s1">&#39; Use old change control APIs for old versions&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v3 Update change control API Call&#39;</span><span class="p">)</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tasks</span><span class="p">):</span>
            <span class="n">stage_id</span> <span class="o">=</span> <span class="s1">&#39;stage</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">index</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stage&#39;</span><span class="p">:</span> <span class="p">[{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">stage_id</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;task&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s1">&#39;TaskID&#39;</span><span class="p">:</span> <span class="n">task</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}]}</span>
            <span class="n">stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;config&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;root_stage&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
                <span class="s1">&#39;stage_row&#39;</span><span class="p">:</span> <span class="n">stages</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/Update&#39;</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.add_notes_to_change_control"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.add_notes_to_change_control">[docs]</a>    <span class="k">def</span> <span class="nf">add_notes_to_change_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">,</span> <span class="n">notes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add provided notes to the specified change control.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): The id for the change control to add notes to.</span>
<span class="sd">                notes (string): The notes to add to the change control.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains...</span>

<span class="sd">                Ex: {&quot;data&quot;: &quot;success&quot;}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;add_notes_to_change_control: cc_id </span><span class="si">%s</span><span class="s1">, notes </span><span class="si">%s</span><span class="s1">&#39;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="n">cc_id</span><span class="p">,</span> <span class="n">notes</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;v3/v4/v5 addNotesToChangeControl API Call deprecated&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;add_notes_to_change_control:&#39;</span>
                             <span class="s1">&#39; change control APIs not supported for v3/v4/v5&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 addNotesToChangeControl API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ccId&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">,</span>
                <span class="s1">&#39;notes&#39;</span><span class="p">:</span> <span class="n">notes</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/changeControl/addNotesToChangeControl.do&#39;</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.execute_change_controls"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.execute_change_controls">[docs]</a>    <span class="k">def</span> <span class="nf">execute_change_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_ids</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Execute the change control indicated by its ccId.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_ids (list): A list of change control IDs to be executed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;v3/v4/v5 /api/v3/services/ccapi.ChangeControl/Start API Call&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cc_id</span> <span class="ow">in</span> <span class="n">cc_ids</span><span class="p">:</span>
                <span class="n">resp_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc_id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">}</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/Start&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
                <span class="n">resp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resp_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 executeCC API Call&#39;</span><span class="p">)</span>
        <span class="n">cc_id_list</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;ccId&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cc_ids</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ccIds&#39;</span><span class="p">:</span> <span class="n">cc_id_list</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/changeControl/executeCC.do&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.approve_change_control"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.approve_change_control">[docs]</a>    <span class="k">def</span> <span class="nf">approve_change_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Cancel the provided change controls.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): The change control IDs to be approved.</span>
<span class="sd">                timestamp(string): The change controls timestamp.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;approve_change_control&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Approval methods not valid for API version </span><span class="si">%s</span><span class="s1">.&#39;</span>
                           <span class="s1">&#39; Functionality did not exist&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v3 Approve change control API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc_id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">,</span> <span class="s1">&#39;cc_timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/AddApproval&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.delete_change_control_approval"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_change_control_approval">[docs]</a>    <span class="k">def</span> <span class="nf">delete_change_control_approval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Cancel the provided change controls.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): The change control IDs to be approved.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;delete_change_control_approval&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Approval methods not valid for API version </span><span class="si">%s</span><span class="s1">.&#39;</span>
                           <span class="s1">&#39; Functionality did not exist&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v3 Delete Approval for change control API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc_id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/DeleteApproval&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.cancel_change_controls"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.cancel_change_controls">[docs]</a>    <span class="k">def</span> <span class="nf">cancel_change_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_ids</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Cancel the provided change controls.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_ids (list): A list of change control IDs to be cancelled.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;v3/v4/v5 /api/v3/services/ccapi.ChangeControl/Stop API Call&#39;</span><span class="p">)</span>
            <span class="n">resp_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cc_id</span> <span class="ow">in</span> <span class="n">cc_ids</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc_id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">}</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/Stop&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
                <span class="n">resp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resp_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 cancelChangeControl API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ccIds&#39;</span><span class="p">:</span> <span class="n">cc_ids</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/changeControl/cancelChangeControl.do&#39;</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.delete_change_controls"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.delete_change_controls">[docs]</a>    <span class="k">def</span> <span class="nf">delete_change_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_ids</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Delete the provided change controls.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_ids (list): A list of change control IDs to be deleted.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v3/v4/v5 /api/v3/services/&#39;</span>
                           <span class="s1">&#39;ccapi.ChangeControl/Delete API Call&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cc_id</span> <span class="ow">in</span> <span class="n">cc_ids</span><span class="p">:</span>
                <span class="n">resp_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc_id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">}</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/Delete&#39;</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
                <span class="n">resp_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">resp_list</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 deleteChangeControl API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ccIds&#39;</span><span class="p">:</span> <span class="n">cc_ids</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/changeControl/deleteChangeControls.do&#39;</span><span class="p">,</span>
                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.get_change_control_info"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_change_control_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_change_control_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get the detailed information for a single change control.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): The id for the change control to be retrieved.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains...</span>

<span class="sd">                Ex: {&#39;ccId&#39;: &#39;4&#39;,</span>
<span class="sd">                     &#39;ccName&#39;: &#39;test_api_1541106830&#39;,</span>
<span class="sd">                     &#39;changeControlTasks&#39;: {&#39;data&#39;: [&lt;task data&gt;],</span>
<span class="sd">                                             &#39;total&#39;: 1},</span>
<span class="sd">                     &#39;classId&#39;: 68,</span>
<span class="sd">                     &#39;containerName&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;countryId&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;createdBy&#39;: &#39;cvpadmin&#39;,</span>
<span class="sd">                     &#39;createdTimestamp&#39;: 1541106831629,</span>
<span class="sd">                     &#39;dateTime&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;deviceCount&#39;: 1,</span>
<span class="sd">                     &#39;executedBy&#39;: &#39;cvpadmin&#39;,</span>
<span class="sd">                     &#39;executedTimestamp&#39;: 1541106831927,</span>
<span class="sd">                     &#39;factoryId&#39;: 1,</span>
<span class="sd">                     &#39;id&#39;: 68,</span>
<span class="sd">                     &#39;key&#39;: &#39;4&#39;,</span>
<span class="sd">                     &#39;notes&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;postSnapshotEndTime&#39;: 0,</span>
<span class="sd">                     &#39;postSnapshotStartTime&#39;: 0,</span>
<span class="sd">                     &#39;preSnapshotEndTime&#39;: 0,</span>
<span class="sd">                     &#39;preSnapshotStartTime&#39;: 0,</span>
<span class="sd">                     &#39;progressStatus&#39;: {&lt;status&gt;},</span>
<span class="sd">                     &#39;scheduledBy&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;scheduledByPassword&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;scheduledTimestamp&#39;: 0,</span>
<span class="sd">                     &#39;snapshotTemplateKey&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;snapshotTemplateName&#39;: None,</span>
<span class="sd">                     &#39;status&#39;: &#39;Inprogress&#39;,</span>
<span class="sd">                     &#39;stopOnError&#39;: False,</span>
<span class="sd">                     &#39;taskCount&#39;: 1,</span>
<span class="sd">                     &#39;taskEndTime&#39;: 0,</span>
<span class="sd">                     &#39;taskStartTime&#39;: 0,</span>
<span class="sd">                     &#39;timeZone&#39;: &#39;&#39;,</span>
<span class="sd">                     &#39;type&#39;: &#39;Custom&#39;}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_change_control_info: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&gt;=</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_change_control_info method deprecated for&#39;</span>
                           <span class="s1">&#39; v3/v4/v5. Moved to get_change_control_status&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;get_change_control_info:&#39;</span>
                             <span class="s1">&#39; info change control API moved for v3/v4/v5 to&#39;</span>
                             <span class="s1">&#39; status&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;v2 getChangeControlInformation.do API Call&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;/changeControl/getChangeControlInformation.do?&#39;</span>
                <span class="s1">&#39;startIndex=0&amp;endIndex=0&amp;ccId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cc_id</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CvpApiError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;No data found&#39;</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">msg</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="n">resp</span></div>

<div class="viewcode-block" id="CvpApi.get_change_control_status"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.get_change_control_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_change_control_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get the detailed information for a single change control.</span>

<span class="sd">            Args:</span>
<span class="sd">                cc_id (string): The id for the change control to be retrieved.</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains...</span>

<span class="sd">                Ex:</span>
<span class="sd">                [{u&#39;status&#39;: {u&#39;error&#39;: u&#39;&#39;,</span>
<span class="sd">                              u&#39;id&#39;: u&#39;cc_id&#39;,</span>
<span class="sd">                              u&#39;stages&#39;: {u&#39; &#39;: {</span>
<span class="sd">                                              u&#39;error&#39;: u&#39;&#39;,</span>
<span class="sd">                                              u&#39;state&#39;: u&#39;Completed&#39;},</span>
<span class="sd">                                          u&#39;Task_0_1&#39;: {</span>
<span class="sd">                                              u&#39;error&#39;: u&#39;&#39;,</span>
<span class="sd">                                              u&#39;state&#39;: u&#39;Completed&#39;}</span>
<span class="sd">                                         },</span>
<span class="sd">                              u&#39;state&#39;: u&#39;Completed&#39;}}]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_change_control_status: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cc_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_cvp_info</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;get_change_control_status method not supported&#39;</span>
                           <span class="s1">&#39; for API version </span><span class="si">%s</span><span class="s1">. Use old&#39;</span>
                           <span class="s1">&#39; get_change_control_info method&#39;</span>
                           <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">apiversion</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;v3 /api/v3/services/ccapi.ChangeControl/GetStatus API Call&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc_id&#39;</span><span class="p">:</span> <span class="n">cc_id</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s1">&#39;/api/v3/services/ccapi.ChangeControl/GetStatus&#39;</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request_timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="CvpApi.reset_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.reset_device">[docs]</a>    <span class="k">def</span> <span class="nf">reset_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Reset device by moving it to the Undefined Container.</span>

<span class="sd">            Args:</span>
<span class="sd">                app_name (str): String to specify info/signifier of calling app</span>
<span class="sd">                device (dict): Device info</span>
<span class="sd">                container (dict): Container info</span>
<span class="sd">                create_task (bool): Determines whether or not to execute a save</span>
<span class="sd">                    and create the tasks (if any)</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: []}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;App </span><span class="si">%s</span><span class="s1"> reseting device </span><span class="si">%s</span><span class="s1"> and moving it to Undefined&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">app_name</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;parentContainerId&#39;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span>
            <span class="n">from_id</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;parentContainerId&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parent_cont</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parent_container_for_device</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
            <span class="n">from_id</span> <span class="o">=</span> <span class="n">parent_cont</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;infoPreview&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
                          <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;reset&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeType&#39;</span><span class="p">:</span> <span class="s1">&#39;netelement&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;nodeId&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toId&#39;</span><span class="p">:</span> <span class="s1">&#39;undefined_container&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;fromId&#39;</span><span class="p">:</span> <span class="n">from_id</span><span class="p">,</span>
                          <span class="s1">&#39;nodeName&#39;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span>
                          <span class="s1">&#39;toName&#39;</span><span class="p">:</span> <span class="s1">&#39;Undefined&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;toIdType&#39;</span><span class="p">:</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;childTasks&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;parentTask&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}]}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_temp_action</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CvpApiError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;Data already exists&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Device </span><span class="si">%s</span><span class="s1"> already in container Undefined&#39;</span>
                               <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CvpApi.deploy_device"><a class="viewcode-back" href="../../cvprac.html#cvprac.cvp_api.CvpApi.deploy_device">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="n">configlets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">image_bundle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;Deploy_device&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Move a device from the undefined container to a target container.</span>
<span class="sd">            Optionally apply device-specific configlets and an image.</span>

<span class="sd">            Args:</span>
<span class="sd">                device (dict): unique key for the device</span>
<span class="sd">                container (str): name of container to move device to</span>
<span class="sd">                configlets (list): list of dicts with configlet key/name pairs</span>
<span class="sd">                image_bundle (str): name of image bundle to apply to device</span>
<span class="sd">                create_task (boolean): Create task for this deploy device</span>
<span class="sd">                    sequence.</span>
<span class="sd">                app_name (str): calling application name for logging purposes</span>

<span class="sd">            Returns:</span>
<span class="sd">                response (dict): A dict that contains a status and a list of</span>
<span class="sd">                    task ids created (if any).</span>

<span class="sd">                    Ex: {u&#39;data&#39;: {u&#39;status&#39;: u&#39;success&#39;, u&#39;taskIds&#39;: [u&#39;32&#39;]}}</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;Deploy device </span><span class="si">%s</span><span class="s1"> to container </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;fqdn&#39;</span><span class="p">],</span> <span class="n">container</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="n">container_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_container_by_name</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
        <span class="c1"># Add action for moving device to specified container</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move_device_to_container</span><span class="p">(</span><span class="n">app_name</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">container_info</span><span class="p">,</span>
                                      <span class="n">create_task</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Get proposed configlets device will inherit from container it is</span>
        <span class="c1"># being moved to.</span>
        <span class="n">prop_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clnt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/provisioning/getTempConfigsByNetElementId.&#39;</span>
                                  <span class="s1">&#39;do?netElementId=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">device</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">])</span>
        <span class="n">new_configlets</span> <span class="o">=</span> <span class="n">prop_conf</span><span class="p">[</span><span class="s1">&#39;proposedConfiglets&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">configlets</span><span class="p">:</span>
            <span class="n">new_configlets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">configlets</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_configlets_to_device</span><span class="p">(</span><span class="s1">&#39;deploy_device&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span>
                                        <span class="n">new_configlets</span><span class="p">,</span> <span class="n">create_task</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Apply image to the device</span>
        <span class="k">if</span> <span class="n">image_bundle</span><span class="p">:</span>
            <span class="n">image_bundle_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_image_bundle_by_name</span><span class="p">(</span><span class="n">image_bundle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_image_to_device</span><span class="p">(</span><span class="n">image_bundle_info</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span>
                                       <span class="n">create_task</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">create_task</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_topology_v2</span><span class="p">([])</span>
        <span class="k">return</span> <span class="kc">None</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Copyright 2020, Arista Netowrks, Inc.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>